// Generated by IcedCoffeeScript 1.7.1-b
describe('Automagic', function() {
  afterEach(function() {
    return $('form').remove();
  });
  describe('#create_hooks', function() {
    it('should add data-automagic attribute to body', function() {
      var automagic;
      automagic = new Automagic();
      automagic.initialize();
      return document.body.hasAttribute('data-automagic').should.eql(true);
    });
    return it('should call hook on each form', function() {
      var automagic, field, form, hook;
      form = document.createElement('form');
      field = document.createElement('input');
      form.appendChild(field);
      document.body.appendChild(form);
      automagic = new Automagic();
      hook = sinon.stub(automagic, 'hook');
      automagic.initialize();
      return hook.should.have.been.calledWith(form);
    });
  });
  describe('#hook', function() {
    it('should add a callback to the form', function() {
      var addEventListener, automagic, field, form;
      form = document.createElement('form');
      addEventListener = sinon.stub(form, 'addEventListener');
      field = document.createElement('input');
      form.appendChild(field);
      document.body.appendChild(form);
      automagic = new Automagic();
      automagic.initialize();
      return addEventListener.should.have.been.calledWith('submit');
    });
    return describe('the callback when the form is submitted', function() {
      return it('should call anything binded to form.onsubmit', function() {
        var automagic, callback, field, form;
        callback = sinon.spy(function(event) {
          return event.preventDefault();
        });
        form = document.createElement('form');
        form.id = 'callback-1';
        form.onsubmit = callback;
        field = document.createElement('input');
        field.name = 'name';
        field.value = 'Tobie';
        form.appendChild(field);
        document.body.appendChild(form);
        automagic = new Automagic();
        automagic.initialize();
        $('#callback-1').submit();
        return callback.should.have.been.called;
      });
    });
  });
  return describe('#extract_data', function() {
    return it('should extract the data', function() {
      var automagic, field_1, field_2, form;
      automagic = new Automagic();
      automagic.initialize();
      form = document.createElement('form');
      field_1 = document.createElement('input');
      field_1.type = 'text';
      field_1.name = 'name';
      field_1.value = 'Tobie';
      form.appendChild(field_1);
      field_2 = document.createElement('textarea');
      field_2.name = 'location';
      field_2.value = 'England';
      form.appendChild(field_2);
      return automagic.extract_data(form).should.eql({
        name: 'Tobie',
        location: 'England'
      });
    });
  });
});
